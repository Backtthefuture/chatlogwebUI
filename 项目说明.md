# 聊天记录查询网站

基于 Node.js + Express 开发的聊天记录查询和显示网站，提供了现代化的 Web 界面来查询和浏览 Chatlog 聊天记录。

## 功能特性

- 🔍 **智能搜索**：支持按时间范围、聊天对象筛选聊天记录
- 📱 **响应式设计**：适配电脑和移动端设备
- 💬 **聊天界面**：仿微信聊天气泡样式，直观展示聊天记录
- 🖼️ **媒体支持**：支持查看图片、语音、文件等多媒体消息
- 📊 **分页浏览**：大量数据分页加载，提升浏览体验
- 📤 **数据导出**：一键导出聊天记录为文本文件
- 🔄 **实时状态**：显示 Chatlog 服务连接状态
- 🎨 **现代化 UI**：渐变背景、毛玻璃效果、动画交互

## 技术栈

- **后端**：Node.js + Express.js
- **前端**：原生 JavaScript + EJS 模板引擎
- **样式**：CSS3 + FontAwesome 图标
- **API**：RESTful API 代理 Chatlog 服务

## 安装部署

### 1. 环境要求

- Node.js 16.x 或更高版本
- 已启动的 Chatlog HTTP 服务（端口 5030）

### 2. 安装依赖

```bash
npm install
```

### 3. 启动服务

```bash
# 开发模式（支持热重载）
npm run dev

# 生产模式
npm start
```

服务启动后访问：http://localhost:3000

### 4. 确保 Chatlog 服务运行

在启动本网站之前，请确保 Chatlog HTTP 服务已在端口 5030 运行：

```bash
# 启动 Chatlog HTTP 服务
chatlog server
```

## 使用指南

### 基本操作流程

1. **连接检查**：打开网站后，右上角会显示 Chatlog 服务连接状态
2. **加载数据**：点击左侧"加载联系人"或"加载群聊"按钮获取聊天对象列表
3. **设置筛选**：选择时间范围和聊天对象
4. **查询记录**：点击"查询聊天记录"按钮获取聊天记录
5. **浏览消息**：在右侧聊天区域浏览消息，支持图片点击放大
6. **导出数据**：查询到数据后可点击"导出"按钮下载文本文件

### 时间范围选择

- **预设选项**：今天、昨天、最近一周、最近一月
- **自定义**：选择具体的开始和结束日期
- **全部时间**：不限制时间范围

### 聊天对象选择

- **联系人**：个人聊天记录
- **群聊**：群聊聊天记录  
- **最近会话**：最近的聊天会话

### 消息类型支持

- **文本消息**：普通文字聊天
- **图片消息**：支持点击查看大图
- **语音消息**：显示语音标识，点击可下载
- **文件消息**：显示文件名，点击可下载

## API 接口

本网站作为 Chatlog API 的代理服务，提供以下接口：

### 聊天记录查询
```
GET /api/chatlog?time=2023-01-01&talker=wxid_xxx&limit=50&offset=0
```

### 联系人列表
```
GET /api/contacts
```

### 群聊列表
```
GET /api/chatrooms
```

### 最近会话
```
GET /api/sessions
```

### 媒体文件
```
GET /api/media?msgid=xxx
```

### 服务状态
```
GET /api/status
```

## 配置说明

### 环境变量

- `PORT`：Web 服务端口（默认 3000）
- `CHATLOG_API_BASE`：Chatlog API 地址（默认 http://127.0.0.1:5030/api/v1）

### 文件结构

```
chatlog-web/
├── package.json          # 项目配置
├── server.js             # Express 服务器
├── views/
│   └── index.ejs         # 主页面模板
├── public/
│   ├── css/
│   │   └── style.css     # 样式文件
│   └── js/
│       └── app.js        # 前端逻辑
└── 项目说明.md          # 项目文档
```

## 故障排除

### 常见问题

1. **连接状态显示未连接**
   - 确保 Chatlog HTTP 服务已启动在端口 5030
   - 检查防火墙是否阻止了端口访问

2. **查询聊天记录失败**
   - 确认 Chatlog 数据已正确解密
   - 检查时间格式是否正确
   - 验证聊天对象 ID 是否有效

3. **图片无法显示**
   - 确保 Chatlog 媒体文件路径正确
   - 检查图片文件是否存在

4. **页面样式异常**
   - 检查网络连接，确保 FontAwesome 图标库正常加载
   - 清除浏览器缓存重试

### 日志查看

启动服务后，控制台会显示详细的请求日志和错误信息，可用于故障诊断。

## 开发说明

### 自定义修改

- **修改样式**：编辑 `public/css/style.css`
- **修改逻辑**：编辑 `public/js/app.js`
- **修改页面**：编辑 `views/index.ejs`
- **修改 API**：编辑 `server.js`

### 添加功能

1. **新增 API 接口**：在 `server.js` 中添加路由
2. **新增前端功能**：在 `app.js` 中添加方法
3. **新增页面元素**：在 `index.ejs` 中添加 HTML
4. **新增样式**：在 `style.css` 中添加 CSS 规则

## 许可协议

MIT License - 可自由使用、修改和分发

## 技术支持

如遇到问题，请检查：
1. Chatlog 官方文档：确保 Chatlog 服务正常运行
2. Node.js 版本：确保使用支持的 Node.js 版本
3. 端口占用：确保端口 3000 和 5030 未被占用
4. 防火墙设置：确保相关端口可以正常访问 