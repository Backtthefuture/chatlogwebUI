# GUI 定时分析配置使用说明

## 概述

本功能提供了一个直观的Web界面来配置和管理定时分析任务，无需手动编辑配置文件或环境变量。

## 功能特点

### 🎯 主要功能
- **可视化配置界面**：通过Web界面进行所有配置
- **简单/高级模式**：支持简单时间选择和高级Cron表达式
- **实时预览**：即时显示Cron表达式预览
- **配置验证**：自动验证Cron表达式格式
- **分析项管理**：显示已配置的分析项状态
- **配置测试**：支持测试配置有效性

## 使用步骤

### 1. 访问配置界面

1. 启动Web服务：`npm start`
2. 打开浏览器访问：`http://localhost:3000`
3. 在"定时分析管理"区域点击"配置定时任务"按钮

### 2. 基本设置

**启用定时分析**
- 使用开关按钮启用或禁用定时分析功能
- 开启后系统将按设定时间自动执行分析

### 3. 执行时间设置

#### 简单模式（推荐新手使用）
- **执行频率**：
  - 每天：每天执行一次
  - 工作日：周一到周五执行
  - 周末：周六和周日执行
  - 每周：每周指定的某一天执行

- **执行时间**：使用时间选择器设置具体时间

#### 高级模式（适合有经验的用户）
- 直接编辑Cron表达式
- 格式：`秒 分 时 日 月 星期`
- 提供常用示例按钮快速设置

**常用Cron表达式示例**：
- `0 0 8 * * *` - 每天8点
- `0 0 9 * * 1-5` - 工作日9点
- `0 0 20 * * *` - 每天20点
- `0 0 */6 * * *` - 每6小时
- `0 0 0 * * 0` - 每周日午夜

### 4. 分析项管理

- **查看分析项**：显示所有已配置的分析项
- **状态检查**：
  - ✅ 已配置：群聊名称和提示词都已设置
  - ⚠️ 未完成：缺少必要配置信息
- **刷新列表**：点击刷新按钮更新分析项状态

### 5. 高级选项

**分析时间范围**
- 昨天：分析前一天的聊天数据
- 今天：分析当天的聊天数据
- 最近3天：分析最近3天的聊天数据
- 最近一周：分析最近一周的聊天数据

**分析间隔**
- 设置每个分析项之间的等待时间（秒）
- 默认3秒，避免API频率限制

**其他选项**
- 跳过无数据的分析项：当群聊无聊天数据时自动跳过
- 启用执行通知：分析完成后显示浏览器通知

### 6. 保存和测试

**测试配置**
- 点击"测试配置"验证Cron表达式
- 显示下次执行时间预览

**保存配置**
- 点击"保存配置"将设置写入.env文件
- 需要重启服务使配置生效

**重置配置**
- 点击"重置"恢复默认设置

## 配置文件说明

配置保存在项目根目录的`.env`文件中：

```env
# 定时分析配置
ENABLE_SCHEDULED_ANALYSIS=true          # 是否启用定时分析
SCHEDULED_ANALYSIS_TIME=0 0 8 * * *     # 执行时间（Cron表达式）
ANALYSIS_TIME_RANGE=yesterday           # 分析时间范围
ANALYSIS_INTERVAL=3                     # 分析间隔（秒）
SKIP_EMPTY_DATA=true                    # 跳过无数据的分析项
ENABLE_NOTIFICATION=false               # 启用执行通知
```

## 常见问题

### Q: 配置保存后为什么没有生效？
A: 需要重启Web服务使配置生效：
```bash
# 停止服务
Ctrl+C

# 重新启动
npm start
```

### Q: 如何确认定时任务正在运行？
A: 在"定时分析管理"区域查看状态：
- 状态显示为"✅ 已启用"
- 执行时间显示具体的Cron表达式
- 分析项数量大于0

### Q: Cron表达式格式错误怎么办？
A: 
1. 确保使用6部分格式：`秒 分 时 日 月 星期`
2. 使用简单模式自动生成正确格式
3. 点击"测试配置"验证表达式

### Q: 为什么分析项显示"未完成"？
A: 确保在"AI分析"区域完整配置：
- 设置分析项名称
- 选择群聊名称
- 输入提示词内容

### Q: 如何查看定时分析的执行结果？
A: 
1. 在"分析历史"中查看结果
2. 定时分析的结果标题带有"[定时]"前缀
3. 查看服务器控制台日志

## 最佳实践

1. **首次使用**：建议使用简单模式设置时间
2. **测试配置**：保存前先测试Cron表达式
3. **合理间隔**：设置适当的分析间隔避免API限制
4. **监控日志**：定期查看服务器日志确认执行状态
5. **备份配置**：重要配置建议备份.env文件

## 技术支持

如遇问题，请：
1. 检查浏览器控制台是否有错误信息
2. 查看服务器控制台日志
3. 确认Chatlog HTTP服务（端口5030）正常运行
4. 验证.env文件格式正确 